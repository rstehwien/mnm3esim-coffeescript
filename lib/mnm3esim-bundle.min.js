// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r,i,s,o=function(e,t){return function(){return e.apply(t,arguments)}},u={}.hasOwnProperty;i=require("./utils.coffee").utils,e=function(){function e(e,t){this.rollCheck=o(this.rollCheck,this),this._applyModifiers=o(this._applyModifiers,this),this._modifiers={},this._modifiable(e),this._values(t)}return e.prototype._modifiable=function(e){var t,n,r,i=this;if(e!=null){r=[];for(t in e){if(!u.call(e,t))continue;n=e[t],r.push(function(e,t){return i["_"+e]=t,Object.defineProperty(i,e,{get:function(){return this._applyModifiers(e,this["_"+e])},set:function(t){return this["_"+e]=t},enumerable:!0,configurable:!0})}(t,n))}return r}},e.prototype._values=function(e){var t,n,r,i=this;if(e!=null){r=[];for(t in e){if(!u.call(e,t))continue;n=e[t],r.push(function(e,t){return i[e]=t}(t,n))}return r}},e.prototype._applyModifiers=function(e,t){var n,r,i,s;r=[],this._modifiers[e]!=null&&Array.prototype.push.apply(r,this._modifiers[e]),this._modifiers["ALL"]!=null&&Array.prototype.push.apply(r,this._modifiers.ALL);for(i=0,s=r.length;i<s;i++)n=r[i],t=n.call(this,t);return t},e.prototype.addModifier=function(e,t){var n,r;return(r=(n=this._modifiers)[e])==null&&(n[e]=[]),this._modifiers[e].push(t)},e.prototype.clearModifiers=function(e){var t,n,r,i;if(e!=null)return this._modifiers[e]=[];r=this._modifiers,i=[];for(t in r){if(!u.call(r,t))continue;n=r[t],i.push(this.clearModifiers(t))}return i},e.prototype.rollCheck=function(e){return e==null&&(e=0),this._applyModifiers("rollCheck",i.rollD20(e))},e.prototype.checkDegree=function(e,t){return i.checkDegree(e,t)},e}(),module.exports={Modifiable:e},s=require("underscore"),n=function(){function e(e,t,n,r){this.group=e,this.property=t,this.modifier=n,this.description=r}return e}(),t=function(){function e(t){var n;t==null&&(t={}),n={key:"normal",degree:0,recovery:!1,replace:null,modifiers:null},t=s.extend(n,t),this.key=t.key,this.degree=t.degree,this.recovery=t.recovery,this.replace=t.replace,this.modifiers=t.modifiers,e.STATUSES[this.key]=this}return e.STATUSES=null,e.getStatus=function(t){var n;if(t instanceof e)return t;if(s.isString(t)){n=e.STATUSES[t];if(n==null)throw new Error("Invalid status '"+t+"'");return n}return null},e.combinedStatus=function(t){var r,i,o,a,f,l,c,h,p,d;c=e._doExpandStatuses(t),f=[],r=[];for(i in c){if(!u.call(c,i))continue;l=c[i],r.push(l.degree);if(s.isArray(l.modifiers)){d=l.modifiers;for(h=0,p=d.length;h<p;h++)o=d[h],s.isArray(o)&&f.push(function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(n,o,function(){}))}}return a=r.length>0?Math.max.apply(Math,r):0,{statuses:c,modifiers:f,degree:a}},e.expandStatuses=function(t){return e.combinedStatus(t).statuses},e.allModifiers=function(t){return e.combinedStatus(t).modifiers},e.degree=function(t){return e.combinedStatus(t).degree},e._doExpandStatuses=function(t){var n,r,i,o,a,f,l,c,h,p,d;s.isObject(t&&!s.isArray(t&&!s.isFunction(t)))&&(t=s.values(t)),s.isArray(t)||(t=[t]),o={};for(l=0,h=t.length;l<h;l++){f=t[l],a=e.getStatus(f);if(a==null||o[a.key]!=null)continue;o[a.key]=a,s.isArray(a.modifiers)&&(o=s.extend(o,e._doExpandStatuses(a.modifiers)))}for(n in o){if(!u.call(o,n))continue;f=o[n],f.replace!=null&&(i=f.replace)}if(i!=null){d=s.flatten(i);for(c=0,p=d.length;c<p;c++)r=d[c],delete o[r]}return s.keys(o).length<1&&(o.normal=e.getStatus("normal")),o["normal"]!=null&&s.keys(o).length>1&&delete o.normal,o},e._init=function(){var t,n,r,i,s;if(e.STATUSES!==null)return;e.STATUSES={},n=[{key:"normal",degree:0,recovery:!1,replace:null,modifiers:null},{key:"compelled",degree:2,recovery:!1,replace:null,modifiers:["actionPartial","actionsControlled"]},{key:"controlled",degree:3,recovery:!1,replace:["compelled"],modifiers:["actionsControlled"]},{key:"dazed",degree:1,recovery:!1,replace:null,modifiers:["actionPartial"]},{key:"debilitated",degree:3,recovery:!1,replace:["disabled","weakened"],modifiers:["actionNone"]},{key:"defenseless",degree:2,recovery:!1,replace:["vulnerable"],modifiers:[["defense","value",function(e){return 0},"defenseless"]]},{key:"disabled",degree:2,recovery:!1,replace:["impaired"],modifiers:[["ALL","rollCheck",function(e){return e-5},"disabled; -5 to checks"]]},{key:"fatigued",degree:1,recovery:!1,replace:null,modifiers:["hindered"]},{key:"hindered",degree:1,recovery:!1,replace:null,modifiers:[["character","speed",function(e){return e-1},"hindered: -1 speed"]]},{key:"immobile",degree:2,recovery:!1,replace:["hindered"],modifiers:[["character","speed",function(e){return null},"immoble: no speed"]]},{key:"impaired",degree:1,recovery:!1,replace:null,modifiers:[["ALL","rollCheck",function(e){return e-2},"impaired; -2 to checks"]]},{key:"stunned",degree:2,recovery:!1,replace:["dazed"],modifiers:["actionNone"]},{key:"transformed",degree:3,recovery:!1,replace:null,modifiers:["actionNone"]},{key:"unaware",degree:3,recovery:!1,replace:null,modifiers:["actionNone"]},{key:"vulnerable",degree:1,recovery:!1,replace:null,modifiers:[["defense","value",function(e){return Math.ceil(e/2)},"vulnerable: 1/2 defense"]]},{key:"weakened",degree:1,recovery:!1,replace:null,modifiers:null},{key:"asleep",degree:3,recovery:!1,replace:null,modifiers:["defenseless","stunned","unaware"]},{key:"blind",degree:2,recovery:!1,replace:null,modifiers:["hindered","unaware","vulnerable","impaired"]},{key:"bound",degree:2,recovery:!1,replace:null,modifiers:["defenseless","immobile","impaired"]},{key:"deaf",degree:2,recovery:!1,replace:null,modifiers:["unaware"]},{key:"dying",degree:4,recovery:!1,replace:null,modifiers:["incapacitated"]},{key:"entranced",degree:1,recovery:!0,replace:null,modifiers:["actionNone"]},{key:"exhausted",degree:2,recovery:!1,replace:["fatigued"],modifiers:["impaired","hindered"]},{key:"incapacitated",degree:3,recovery:!1,replace:null,modifiers:["defenseless","stunned","unaware","prone"]},{key:"paralyzed",degree:3,recovery:!1,replace:null,modifiers:["defenseless","immobile","stunned"]},{key:"prone",degree:2,recovery:!1,replace:null,modifiers:["hindered",["defense","value",function(e){return e-5},"prone: -5 defense"]]},{key:"restrained",degree:2,recovery:!1,replace:null,modifiers:["hindered","vulnerable"]},{key:"staggered",degree:2,recovery:!1,replace:null,modifiers:["dazed","hindered"]},{key:"suprised",degree:1,recovery:!0,replace:null,modifiers:["stunned","vulnerable"]},{key:"actionPartial",degree:0,recovery:!1,replace:null,modifiers:[["character","actions",function(e){return"partial"},"partial actions"]]},{key:"actionNone",degree:0,recovery:!1,replace:["actionPartial"],modifiers:[["character","actions",function(e){return"none"},"no actions"]]},{key:"actionsControlled",degree:0,recovery:!1,replace:null,modifiers:[["character","isControlled",function(e){return!0},"actions controlled"]]}],s=[];for(r=0,i=n.length;r<i;r++)t=n[r],s.push(new e(t));return s},e}(),t._init(),module.exports={Status:t,StatusModifier:n},r=function(){function e(){}return e.rollD20=function(e){return e==null&&(e=0),Math.floor(Math.random()*20)+1+e},e.checkDegree=function(e,t){var n;return n=t-e,Math.floor(n/5)+(n<0?0:1)},e}(),module.exports={utils:r}}).call(this);